<!DOCTYPE html>
<html>
<head>

<!--Meta for the browser to allow mobile first design-->
<meta charset="utf-8" />
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />

<title>Veteran Grave Locator</title>

<!--Adds CSS for the survey button-->
<style>
    html,
    body,
    #viewDiv {
     padding: 0;
     margin: 0;
     height: 100%;
     width: 100%;
    }

    #branch-filter {
        height: 240px;
        width: 100%;
        visibility: hidden;
    }

    .branch-item {
        width: 100%;
        padding: 12px;
        text-align: center;
        vertical-align: baseline;
        cursor: pointer;
        height: 40px;
    }

    .branch-item:focus {
        background-color: dimgrey;
    }

    .branch-item:hover {
        background-color: dimgrey;
    }

    /*Sets position and appearance of the survey button*/
    .addRecordBtn {
        position: absolute;
        z-index: 10;
        top: 15px;
        left: 50px;
        background-color: #035e30;
        color: white;
        padding: 4px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        text-decoration: none;
    }

    /*Changes buttons color on mouseover*/
    .addRecordBtn:hover {
        background-color: #04c292;
    }

   </style>

<!--importing the css and libraries for esri.js-->
<link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" />
<script src="https://js.arcgis.com/4.32/"></script>

<!--Loading the modules-->
<script>
    require([
        "esri/config", 
        "esri/Map", 
        "esri/views/MapView",
        "esri/widgets/Locate",
        "esri/widgets/Search",
        "esri/widgets/Expand",
        "esri/layers/FeatureLayer",
        "esri/renderers/UniqueValueRenderer",
        "esri/symbols/SimpleFillSymbol",
        "esri/widgets/BasemapGallery",
        "esri/core/reactiveUtils",
        "esri/Graphic",
        "esri/layers/GraphicsLayer",
        "esri/widgets/Legend",
        "esri/widgets/Measurement"
        ],
        (esriConfig, Map, MapView, Locate, Search, Expand, FeatureLayer, UniqueValueRenderer, SimpleFillSymbol, BasemapGallery, reactiveUtils, Graphics, GraphicsLayer, Legend, Measurement) => {

        esriConfig.apiKey = "AAPTxy8BH1VEsoebNVZXo8HurFoJhgAIY5vGdEdRRAp_EKP3hX46okWbzREzvFOzP3eLMTfinmEi1544H3VrGFnlV6so5dUw7YSu9YGDC-954nuy6aTLI9VPTXITBZEeNsSF0B_tJQ2mneOXc37qlXwggQdzOgIhxiVPZ-epbypcjNDg4G07YzvTAEXRmJH4Uzp6A7Fe2exbTdDRIfg-kRmtFyJLbin0Nuyzz1scUr_FYroHbqoG10J0HaQOMyE-HceUAT1_1S7BNGTZ";  

        // Setting up the map and the view
        const map = new Map({
            basemap: "streets"  // Initial basemap
        });

        const view = new MapView({
            container: "viewDiv",  // Where the map will appear
            map: map,  // The map itself
            center: [-88.311315,43.9742216],  // Starting location (Calumet County)
            zoom: 17  // Initial zoom level
        });

        // Re-adding GraveLayer and UniqueValueRenderer
        const graveLayer = new FeatureLayer({
            title: "Gravesites", 
            url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/survey123_28f092bf47774a35b1aa173968373955_results/FeatureServer",
            outFields: ["fName", "mName", "lName", "milRank", "branch"],
            renderer: new UniqueValueRenderer({
                field: "branch",
                uniqueValueInfos: [
                    { value: "Army", symbol: { type: "simple-marker", color: "green", size: "8px" }, label: "Army" },
                    { value: "Navy", symbol: { type: "simple-marker", color: "blue", size: "8px" }, label: "Navy" },
                    { value: "Marines", symbol: { type: "simple-marker", color: "red", size: "8px" }, label: "Marines" },
                    { value: "Air Force", symbol: { type: "simple-marker", color: "cyan", size: "8px" }, label: "Air Force" },
                    { value: "Coast Guard", symbol: { type: "simple-marker", color: "orange", size: "8px" }, label: "Coast Guard" }
                ]
            })
        });
        map.add(graveLayer);

        // Adding a measurement tool
        const measureTool = new Measurement({
            view: view,
            activeTool: "area"
        });
        view.ui.add(measureTool, "top-right");

        // Enhanced Search Widget
        const searchWidget = new Search({
            view: view,
            sources: [{
                layer: graveLayer,
                searchFields: ["lName", "fName"],
                displayField: "lName",
                name: "Search Gravesites",
                placeholder: "Search by Last or First Name"
            }]
        });
        view.ui.add(searchWidget, "top-left");

        // Adding Locate Button
        const locateBtn = new Locate({
            view: view
        });
        view.ui.add(locateBtn, "top-left");
    });
</script>

</head>

<body>
    <div id="viewDiv"></div>
</body>

</html>
